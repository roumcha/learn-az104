# 仮想マシン

- IaaSモデル: CSPは物理部分の責任を持つ

- メリット:
  - 環境の設置、解体、スケーリングが迅速化
  - コスト削減
  - 復旧の簡略化
  - 高性能の実現

## 仮想マシンの計画

### 1 ネットワーク構成

プライベートネットワークへの接続や、外部サービスへの接続などといった構成は、後から変更するのが大変。

まずはネットワークアドレスやサブネットを考慮する。

### 2 仮想マシン名

- 後から変更するのは難しいので、先に決める

- Windows には 15 文字まで、Linux には 64 文字まで

- 例: `devusc-webvm01` （開発、米国中部、Webサーバー、1つめ）

- ほか、使用するソフトウェア製品名などを入れてもよい

### 3 場所

どの地域のデータセンターを使うか？

価格、提供するサービス、コンプライアンス、距離、冗長性、可用性を考慮。

### 4 サイズ

- 汎用: バランス型
- コンピューティング最適化: CPU特化
- メモリ最適化: メモリ特化。RDBやキャッシュ、メモリ内分析向け。
- ストレージ最適化: ディスクのスループット特化。DB向け。
- GPU: GPU特化。レンダリングやディープラーニング向け。
- ハイパフォーマンス: 最速のCPU、高速ネットワークインターフェース。

一応、途中でサイズ変更もできるが、停止や再起動、IPアドレスの変更に注意。

### 5 ストレージ

- Azure BLOB上のVHD

- OSディスクx1 (Cドライブ、SATA)

- 一時ディスクx1 (Dドライブまたは `/dev/sdb` と `/mnt`)
  - アプリケーションのページングやスワップ以外に使わない！

- 任意でデータディスク (任意のラベル、SCSI) を追加できる
  - VMのサイズによって上限数と種類が決まる

- Managed Disk: ページBLOB、BLOBコンテナー、ストレージアカウントを抽象化したVHD
  - Ultra SSD
  - Premium SSD
  - Standard SSD
  - Standard HDD

- Premium Storage: I/Oが強いSSD

### 6 コスト

- 分単位で請求される

- 停止 + 割り当て解除 で請求が止まる

- 課金方式
  - 使用量ベース
  - 予約インスタンス: 1年または3年分予約購入して、最大72%の割引。交換や早期解約も可能。

### 7 OS

希望のものが無ければ、Azure Marketplace やディスクイメージから作成も可能。

## VMに接続する

- RDP
  - すべてのWindows VMはGUIセッションに対応

- SSH
  - Linux VMに接続
  - VMに公開鍵、ローカルに秘密鍵を配置
  - 組織のポリシーに応じて、鍵ペアを複数のVMに使いまわしてもよい

- Azure Bastion: VMをパブリックアドレスで公開することなく、RDPやSSH接続を行うPaaS
